[{"type":"heading","raw":"# Batch\n\n","depth":1,"text":"Batch","tokens":[{"type":"text","raw":"Batch","text":"Batch","escaped":false}]},{"type":"heading","raw":"## Overview\n\n","depth":2,"text":"Overview","tokens":[{"type":"text","raw":"Overview","text":"Overview","escaped":false}]},{"type":"paragraph","raw":"This article explains how to use the Batch API to initiate offline tasks that utilize lower-cost computing resources. This approach is suitable for scenarios where immediate results are not required and there is a need for offline processing of large amounts of data, such as model evaluation, semantic extraction of datasets, and batch extraction of text vectors.","text":"This article explains how to use the Batch API to initiate offline tasks that utilize lower-cost computing resources. This approach is suitable for scenarios where immediate results are not required and there is a need for offline processing of large amounts of data, such as model evaluation, semantic extraction of datasets, and batch extraction of text vectors.","tokens":[{"type":"text","raw":"This article explains how to use the Batch API to initiate offline tasks that utilize lower-cost computing resources. This approach is suitable for scenarios where immediate results are not required and there is a need for offline processing of large amounts of data, such as model evaluation, semantic extraction of datasets, and batch extraction of text vectors.","text":"This article explains how to use the Batch API to initiate offline tasks that utilize lower-cost computing resources. This approach is suitable for scenarios where immediate results are not required and there is a need for offline processing of large amounts of data, such as model evaluation, semantic extraction of datasets, and batch extraction of text vectors.","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"paragraph","raw":"Through the Batch Inference API, you can specify the corresponding service and submit tasks in batches via a file. These tasks will be asynchronously scheduled and executed. Before the tasks are successfully completed, you can check the status of the tasks via the API, and once the tasks are finished, you can retrieve the results through the API.","text":"Through the Batch Inference API, you can specify the corresponding service and submit tasks in batches via a file. These tasks will be asynchronously scheduled and executed. Before the tasks are successfully completed, you can check the status of the tasks via the API, and once the tasks are finished, you can retrieve the results through the API.","tokens":[{"type":"text","raw":"Through the Batch Inference API, you can specify the corresponding service and submit tasks in batches via a file. These tasks will be asynchronously scheduled and executed. Before the tasks are successfully completed, you can check the status of the tasks via the API, and once the tasks are finished, you can retrieve the results through the API.","text":"Through the Batch Inference API, you can specify the corresponding service and submit tasks in batches via a file. These tasks will be asynchronously scheduled and executed. Before the tasks are successfully completed, you can check the status of the tasks via the API, and once the tasks are finished, you can retrieve the results through the API.","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"paragraph","raw":"Compared to regular synchronous services, the Batch Inference API has the following advantages:","text":"Compared to regular synchronous services, the Batch Inference API has the following advantages:","tokens":[{"type":"text","raw":"Compared to regular synchronous services, the Batch Inference API has the following advantages:","text":"Compared to regular synchronous services, the Batch Inference API has the following advantages:","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"list","raw":"1. **Lower Cost**: Tasks are scheduled and executed elastically, resulting in lower costs and prices.\n2. **Higher Task Concurrency**: Batch processing jobs do not consume your valuable synchronous call rate limit capacity, allowing online business and batch tasks to proceed without interference.\n3. **More Convenient Job Submission Method**: Simply generate a batch job file according to the protocol, submit it once, and automatically retrieve all job results after completion, facilitating subsequent structured processing.","ordered":true,"start":1,"loose":false,"items":[{"type":"list_item","raw":"1. **Lower Cost**: Tasks are scheduled and executed elastically, resulting in lower costs and prices.\n","task":false,"loose":false,"text":"**Lower Cost**: Tasks are scheduled and executed elastically, resulting in lower costs and prices.","tokens":[{"type":"text","raw":"**Lower Cost**: Tasks are scheduled and executed elastically, resulting in lower costs and prices.","text":"**Lower Cost**: Tasks are scheduled and executed elastically, resulting in lower costs and prices.","tokens":[{"type":"strong","raw":"**Lower Cost**","text":"Lower Cost","tokens":[{"type":"text","raw":"Lower Cost","text":"Lower Cost","escaped":false}]},{"type":"text","raw":": Tasks are scheduled and executed elastically, resulting in lower costs and prices.","text":": Tasks are scheduled and executed elastically, resulting in lower costs and prices.","escaped":false}]}]},{"type":"list_item","raw":"2. **Higher Task Concurrency**: Batch processing jobs do not consume your valuable synchronous call rate limit capacity, allowing online business and batch tasks to proceed without interference.\n","task":false,"loose":false,"text":"**Higher Task Concurrency**: Batch processing jobs do not consume your valuable synchronous call rate limit capacity, allowing online business and batch tasks to proceed without interference.","tokens":[{"type":"text","raw":"**Higher Task Concurrency**: Batch processing jobs do not consume your valuable synchronous call rate limit capacity, allowing online business and batch tasks to proceed without interference.","text":"**Higher Task Concurrency**: Batch processing jobs do not consume your valuable synchronous call rate limit capacity, allowing online business and batch tasks to proceed without interference.","tokens":[{"type":"strong","raw":"**Higher Task Concurrency**","text":"Higher Task Concurrency","tokens":[{"type":"text","raw":"Higher Task Concurrency","text":"Higher Task Concurrency","escaped":false}]},{"type":"text","raw":": Batch processing jobs do not consume your valuable synchronous call rate limit capacity, allowing online business and batch tasks to proceed without interference.","text":": Batch processing jobs do not consume your valuable synchronous call rate limit capacity, allowing online business and batch tasks to proceed without interference.","escaped":false}]}]},{"type":"list_item","raw":"3. **More Convenient Job Submission Method**: Simply generate a batch job file according to the protocol, submit it once, and automatically retrieve all job results after completion, facilitating subsequent structured processing.","task":false,"loose":false,"text":"**More Convenient Job Submission Method**: Simply generate a batch job file according to the protocol, submit it once, and automatically retrieve all job results after completion, facilitating subsequent structured processing.","tokens":[{"type":"text","raw":"**More Convenient Job Submission Method**: Simply generate a batch job file according to the protocol, submit it once, and automatically retrieve all job results after completion, facilitating subsequent structured processing.","text":"**More Convenient Job Submission Method**: Simply generate a batch job file according to the protocol, submit it once, and automatically retrieve all job results after completion, facilitating subsequent structured processing.","tokens":[{"type":"strong","raw":"**More Convenient Job Submission Method**","text":"More Convenient Job Submission Method","tokens":[{"type":"text","raw":"More Convenient Job Submission Method","text":"More Convenient Job Submission Method","escaped":false}]},{"type":"text","raw":": Simply generate a batch job file according to the protocol, submit it once, and automatically retrieve all job results after completion, facilitating subsequent structured processing.","text":": Simply generate a batch job file according to the protocol, submit it once, and automatically retrieve all job results after completion, facilitating subsequent structured processing.","escaped":false}]}]}]},{"type":"space","raw":"\n\n"},{"type":"paragraph","raw":"Applicable Model Range:","text":"Applicable Model Range:","tokens":[{"type":"text","raw":"Applicable Model Range:","text":"Applicable Model Range:","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"list","raw":"* qwen-max\n* qwen-plus\n* qwen-turbo","ordered":false,"start":"","loose":false,"items":[{"type":"list_item","raw":"* qwen-max\n","task":false,"loose":false,"text":"qwen-max","tokens":[{"type":"text","raw":"qwen-max","text":"qwen-max","tokens":[{"type":"text","raw":"qwen-max","text":"qwen-max","escaped":false}]}]},{"type":"list_item","raw":"* qwen-plus\n","task":false,"loose":false,"text":"qwen-plus","tokens":[{"type":"text","raw":"qwen-plus","text":"qwen-plus","tokens":[{"type":"text","raw":"qwen-plus","text":"qwen-plus","escaped":false}]}]},{"type":"list_item","raw":"* qwen-turbo","task":false,"loose":false,"text":"qwen-turbo","tokens":[{"type":"text","raw":"qwen-turbo","text":"qwen-turbo","tokens":[{"type":"text","raw":"qwen-turbo","text":"qwen-turbo","escaped":false}]}]}]},{"type":"space","raw":"\n\n"},{"type":"paragraph","raw":"Available Services: Service prefix `https://dashscope.aliyuncs.com/compatible-mode`","text":"Available Services: Service prefix `https://dashscope.aliyuncs.com/compatible-mode`","tokens":[{"type":"text","raw":"Available Services: Service prefix ","text":"Available Services: Service prefix ","escaped":false},{"type":"codespan","raw":"`https://dashscope.aliyuncs.com/compatible-mode`","text":"https://dashscope.aliyuncs.com/compatible-mode"}]},{"type":"space","raw":"\n\n"},{"type":"list","raw":"* `/v1/chat/completions`","ordered":false,"start":"","loose":false,"items":[{"type":"list_item","raw":"* `/v1/chat/completions`","task":false,"loose":false,"text":"`/v1/chat/completions`","tokens":[{"type":"text","raw":"`/v1/chat/completions`","text":"`/v1/chat/completions`","tokens":[{"type":"codespan","raw":"`/v1/chat/completions`","text":"/v1/chat/completions"}]}]}]},{"type":"space","raw":"\n\n"},{"type":"heading","raw":"## Quick Start\n\n","depth":2,"text":"Quick Start","tokens":[{"type":"text","raw":"Quick Start","text":"Quick Start","escaped":false}]},{"type":"heading","raw":"### 1. Prepare Your Batch File\n\n","depth":3,"text":"1. Prepare Your Batch File","tokens":[{"type":"text","raw":"1. Prepare Your Batch File","text":"1. Prepare Your Batch File","escaped":false}]},{"type":"paragraph","raw":"The batch file uses the `jsonl` format, with each line of data representing a request in JSON string format. Each line of data includes the following fields:","text":"The batch file uses the `jsonl` format, with each line of data representing a request in JSON string format. Each line of data includes the following fields:","tokens":[{"type":"text","raw":"The batch file uses the ","text":"The batch file uses the ","escaped":false},{"type":"codespan","raw":"`jsonl`","text":"jsonl"},{"type":"text","raw":" format, with each line of data representing a request in JSON string format. Each line of data includes the following fields:","text":" format, with each line of data representing a request in JSON string format. Each line of data includes the following fields:","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"list","raw":"* `custom_id`: Represents the unique ID of the request, which should not be duplicated and is used to retrieve the corresponding request data after the batch task is completed.\n* `method`: Currently, only POST is supported, indicating the request method.\n* `url`: The service URL, currently only supports `/v1/chat/completions`, and the URL must be consistent within a batch file.\n* `body`: The corresponding request parameters.","ordered":false,"start":"","loose":false,"items":[{"type":"list_item","raw":"* `custom_id`: Represents the unique ID of the request, which should not be duplicated and is used to retrieve the corresponding request data after the batch task is completed.\n","task":false,"loose":false,"text":"`custom_id`: Represents the unique ID of the request, which should not be duplicated and is used to retrieve the corresponding request data after the batch task is completed.","tokens":[{"type":"text","raw":"`custom_id`: Represents the unique ID of the request, which should not be duplicated and is used to retrieve the corresponding request data after the batch task is completed.","text":"`custom_id`: Represents the unique ID of the request, which should not be duplicated and is used to retrieve the corresponding request data after the batch task is completed.","tokens":[{"type":"codespan","raw":"`custom_id`","text":"custom_id"},{"type":"text","raw":": Represents the unique ID of the request, which should not be duplicated and is used to retrieve the corresponding request data after the batch task is completed.","text":": Represents the unique ID of the request, which should not be duplicated and is used to retrieve the corresponding request data after the batch task is completed.","escaped":false}]}]},{"type":"list_item","raw":"* `method`: Currently, only POST is supported, indicating the request method.\n","task":false,"loose":false,"text":"`method`: Currently, only POST is supported, indicating the request method.","tokens":[{"type":"text","raw":"`method`: Currently, only POST is supported, indicating the request method.","text":"`method`: Currently, only POST is supported, indicating the request method.","tokens":[{"type":"codespan","raw":"`method`","text":"method"},{"type":"text","raw":": Currently, only POST is supported, indicating the request method.","text":": Currently, only POST is supported, indicating the request method.","escaped":false}]}]},{"type":"list_item","raw":"* `url`: The service URL, currently only supports `/v1/chat/completions`, and the URL must be consistent within a batch file.\n","task":false,"loose":false,"text":"`url`: The service URL, currently only supports `/v1/chat/completions`, and the URL must be consistent within a batch file.","tokens":[{"type":"text","raw":"`url`: The service URL, currently only supports `/v1/chat/completions`, and the URL must be consistent within a batch file.","text":"`url`: The service URL, currently only supports `/v1/chat/completions`, and the URL must be consistent within a batch file.","tokens":[{"type":"codespan","raw":"`url`","text":"url"},{"type":"text","raw":": The service URL, currently only supports ","text":": The service URL, currently only supports ","escaped":false},{"type":"codespan","raw":"`/v1/chat/completions`","text":"/v1/chat/completions"},{"type":"text","raw":", and the URL must be consistent within a batch file.","text":", and the URL must be consistent within a batch file.","escaped":false}]}]},{"type":"list_item","raw":"* `body`: The corresponding request parameters.","task":false,"loose":false,"text":"`body`: The corresponding request parameters.","tokens":[{"type":"text","raw":"`body`: The corresponding request parameters.","text":"`body`: The corresponding request parameters.","tokens":[{"type":"codespan","raw":"`body`","text":"body"},{"type":"text","raw":": The corresponding request parameters.","text":": The corresponding request parameters.","escaped":false}]}]}]},{"type":"space","raw":"\n\n"},{"type":"paragraph","raw":"For example, the following sample data is a batch file containing two requests. Note that all requests in a file must be for the same model service.","text":"For example, the following sample data is a batch file containing two requests. Note that all requests in a file must be for the same model service.","tokens":[{"type":"text","raw":"For example, the following sample data is a batch file containing two requests. Note that all requests in a file must be for the same model service.","text":"For example, the following sample data is a batch file containing two requests. Note that all requests in a file must be for the same model service.","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```json\n{\"custom_id\": \"request-1\", \"method\": \"POST\", \"url\": \"/v1/chat/completions\", \"body\": {\"model\": \"qwen-plus\", \"messages\": [{\"role\": \"system\", \"content\": \"You are a helpful assistant.\"}, {\"role\": \"user\", \"content\": \"Hello world!\"}], \"max_tokens\": 1000}}\n{\"custom_id\": \"request-2\", \"method\": \"POST\", \"url\": \"/v1/chat/completions\", \"body\": {\"model\": \"qwen-plus\", \"messages\": [{\"role\": \"system\", \"content\": \"You are an unhelpful assistant.\"}, {\"role\": \"user\", \"content\": \"Hello world!\"}], \"max_tokens\": 1000}}\n```","lang":"json","text":"{\"custom_id\": \"request-1\", \"method\": \"POST\", \"url\": \"/v1/chat/completions\", \"body\": {\"model\": \"qwen-plus\", \"messages\": [{\"role\": \"system\", \"content\": \"You are a helpful assistant.\"}, {\"role\": \"user\", \"content\": \"Hello world!\"}], \"max_tokens\": 1000}}\n{\"custom_id\": \"request-2\", \"method\": \"POST\", \"url\": \"/v1/chat/completions\", \"body\": {\"model\": \"qwen-plus\", \"messages\": [{\"role\": \"system\", \"content\": \"You are an unhelpful assistant.\"}, {\"role\": \"user\", \"content\": \"Hello world!\"}], \"max_tokens\": 1000}}"},{"type":"space","raw":"\n\n"},{"type":"heading","raw":"### 2. Upload the File\n\n","depth":3,"text":"2. Upload the File","tokens":[{"type":"text","raw":"2. Upload the File","text":"2. Upload the File","escaped":false}]},{"type":"paragraph","raw":"Use the file upload interface to complete the file upload, as shown in the example below.","text":"Use the file upload interface to complete the file upload, as shown in the example below.","tokens":[{"type":"text","raw":"Use the file upload interface to complete the file upload, as shown in the example below.","text":"Use the file upload interface to complete the file upload, as shown in the example below.","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```python\nfrom pathlib import Path\nfrom openai import OpenAI\n\nclient = OpenAI(\n    api_key=\"$your-dashscope-api-key\",\n    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\", \n)\n\n# data.pdf is a sample file\nbatch_input_file = client.files.create(file=Path(\"batchinput.jsonl\"), purpose=\"batch\")\n```    ","lang":"python","text":"from pathlib import Path\nfrom openai import OpenAI\n\nclient = OpenAI(\n    api_key=\"$your-dashscope-api-key\",\n    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\", \n)\n\n# data.pdf is a sample file\nbatch_input_file = client.files.create(file=Path(\"batchinput.jsonl\"), purpose=\"batch\")"},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```shell\ncurl https://dashscope.aliyuncs.com/compatible-mode/v1/files  \\\n  -H \"Authorization: Bearer $DASHSCOPE_API_KEY\" \\\n  -F purpose=\"batch\" \\\n  -F file=\"@batchinput.jsonl\"\n```","lang":"shell","text":"curl https://dashscope.aliyuncs.com/compatible-mode/v1/files  \\\n  -H \"Authorization: Bearer $DASHSCOPE_API_KEY\" \\\n  -F purpose=\"batch\" \\\n  -F file=\"@batchinput.jsonl\""},{"type":"space","raw":"\n\n"},{"type":"heading","raw":"### 3. Create a Batch Task\n\n","depth":3,"text":"3. Create a Batch Task","tokens":[{"type":"text","raw":"3. Create a Batch Task","text":"3. Create a Batch Task","escaped":false}]},{"type":"paragraph","raw":"After the file upload is completed, you can create a batch task with the file object ID. For example, with the file object ID `file-abc123`, you can make a request as follows and add custom information through the `metadata` field.","text":"After the file upload is completed, you can create a batch task with the file object ID. For example, with the file object ID `file-abc123`, you can make a request as follows and add custom information through the `metadata` field.","tokens":[{"type":"text","raw":"After the file upload is completed, you can create a batch task with the file object ID. For example, with the file object ID ","text":"After the file upload is completed, you can create a batch task with the file object ID. For example, with the file object ID ","escaped":false},{"type":"codespan","raw":"`file-abc123`","text":"file-abc123"},{"type":"text","raw":", you can make a request as follows and add custom information through the ","text":", you can make a request as follows and add custom information through the ","escaped":false},{"type":"codespan","raw":"`metadata`","text":"metadata"},{"type":"text","raw":" field.","text":" field.","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```python\nbatch_input_file_id = batch_input_file.id\n\nbatch = client.batches.create(\n    input_file_id=batch_input_file_id,\n    endpoint=\"/v1/chat/completions\",\n    completion_window=\"24h\",\n    metadata={\n      \"description\": \"nightly eval job\"\n    }\n)\n```","lang":"python","text":"batch_input_file_id = batch_input_file.id\n\nbatch = client.batches.create(\n    input_file_id=batch_input_file_id,\n    endpoint=\"/v1/chat/completions\",\n    completion_window=\"24h\",\n    metadata={\n      \"description\": \"nightly eval job\"\n    }\n)"},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```sh\ncurl https://dashscope.aliyuncs.com/compatible-mode/v1/batches  \\\n  -H \"Authorization: Bearer $DASHSCOPE_API_KEY\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"input_file_id\": \"file-abc123\",\n    \"endpoint\": \"/v1/chat/completions\",\n    \"completion_window\": \"24h\"\n  }'\n```","lang":"sh","text":"curl https://dashscope.aliyuncs.com/compatible-mode/v1/batches  \\\n  -H \"Authorization: Bearer $DASHSCOPE_API_KEY\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"input_file_id\": \"file-abc123\",\n    \"endpoint\": \"/v1/chat/completions\",\n    \"completion_window\": \"24h\"\n  }'"},{"type":"space","raw":"\n\n"},{"type":"paragraph","raw":"The output will return a Batch object, as shown in the example below, where `output_file_id` represents the output file ID. Once the results are ready, you can retrieve the result file based on this ID.","text":"The output will return a Batch object, as shown in the example below, where `output_file_id` represents the output file ID. Once the results are ready, you can retrieve the result file based on this ID.","tokens":[{"type":"text","raw":"The output will return a Batch object, as shown in the example below, where ","text":"The output will return a Batch object, as shown in the example below, where ","escaped":false},{"type":"codespan","raw":"`output_file_id`","text":"output_file_id"},{"type":"text","raw":" represents the output file ID. Once the results are ready, you can retrieve the result file based on this ID.","text":" represents the output file ID. Once the results are ready, you can retrieve the result file based on this ID.","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```json\n{\n  \"id\": \"batch_abc123\",\n  \"object\": \"batch\",\n  \"endpoint\": \"/v1/chat/completions\",\n  \"errors\": null,\n  \"input_file_id\": \"file-abc123\",\n  \"completion_window\": \"24h\",\n  \"status\": \"validating\",\n  \"output_file_id\": null,\n  \"error_file_id\": null,\n  \"created_at\": 1714508499,\n  \"in_progress_at\": null,\n  \"expires_at\": 1714536634,\n  \"completed_at\": null,\n  \"failed_at\": null,\n  \"expired_at\": null,\n  \"request_counts\": {\n    \"total\": 0,\n    \"completed\": 0,\n    \"failed\": 0\n  },\n  \"metadata\": null\n}\n```","lang":"json","text":"{\n  \"id\": \"batch_abc123\",\n  \"object\": \"batch\",\n  \"endpoint\": \"/v1/chat/completions\",\n  \"errors\": null,\n  \"input_file_id\": \"file-abc123\",\n  \"completion_window\": \"24h\",\n  \"status\": \"validating\",\n  \"output_file_id\": null,\n  \"error_file_id\": null,\n  \"created_at\": 1714508499,\n  \"in_progress_at\": null,\n  \"expires_at\": 1714536634,\n  \"completed_at\": null,\n  \"failed_at\": null,\n  \"expired_at\": null,\n  \"request_counts\": {\n    \"total\": 0,\n    \"completed\": 0,\n    \"failed\": 0\n  },\n  \"metadata\": null\n}"},{"type":"space","raw":"\n\n"},{"type":"heading","raw":"### 4. Check Task Status\n\n","depth":3,"text":"4. Check Task Status","tokens":[{"type":"text","raw":"4. Check Task Status","text":"4. Check Task Status","escaped":false}]},{"type":"paragraph","raw":"During the task execution, you can check the task status.","text":"During the task execution, you can check the task status.","tokens":[{"type":"text","raw":"During the task execution, you can check the task status.","text":"During the task execution, you can check the task status.","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```python\nfrom openai import OpenAI\n\nclient = OpenAI(\n    api_key=\"$your-dashscope-api-key\",\n    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\", \n)\n\nclient.batches.retrieve(batch.id)\n```","lang":"python","text":"from openai import OpenAI\n\nclient = OpenAI(\n    api_key=\"$your-dashscope-api-key\",\n    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\", \n)\n\nclient.batches.retrieve(batch.id)"},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```sh\ncurl https://dashscope.aliyuncs.com/compatible-mode/v1/batches/batch_abc123  \\\n  -H \"Authorization: Bearer $DASHSCOPE_API_KEY\" \\\n  -H \"Content-Type: application/json\"\n```","lang":"sh","text":"curl https://dashscope.aliyuncs.com/compatible-mode/v1/batches/batch_abc123  \\\n  -H \"Authorization: Bearer $DASHSCOPE_API_KEY\" \\\n  -H \"Content-Type: application/json\""},{"type":"space","raw":"\n\n"},{"type":"paragraph","raw":"The corresponding task status has the following return values:","text":"The corresponding task status has the following return values:","tokens":[{"type":"text","raw":"The corresponding task status has the following return values:","text":"The corresponding task status has the following return values:","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"table","raw":"| **Status Code** | **Description** |\n| --- | --- |\n| `validating` | Validating input file |\n| `failed` | Input file validation failed |\n| `in_progress` | Validation successful, task in progress |\n| `finalizing` | Task completed, summarizing results |\n| `completed` | Task completed, results summarized |\n| `expired` | Task timed out within 24 hours, not executed |\n| `cancelling` | Task cancellation in progress |\n| `cancelled` | Task has been cancelled |\n\n","header":[{"text":"**Status Code**","tokens":[{"type":"strong","raw":"**Status Code**","text":"Status Code","tokens":[{"type":"text","raw":"Status Code","text":"Status Code","escaped":false}]}],"header":true,"align":null},{"text":"**Description**","tokens":[{"type":"strong","raw":"**Description**","text":"Description","tokens":[{"type":"text","raw":"Description","text":"Description","escaped":false}]}],"header":true,"align":null}],"align":[null,null],"rows":[[{"text":"`validating`","tokens":[{"type":"codespan","raw":"`validating`","text":"validating"}],"header":false,"align":null},{"text":"Validating input file","tokens":[{"type":"text","raw":"Validating input file","text":"Validating input file","escaped":false}],"header":false,"align":null}],[{"text":"`failed`","tokens":[{"type":"codespan","raw":"`failed`","text":"failed"}],"header":false,"align":null},{"text":"Input file validation failed","tokens":[{"type":"text","raw":"Input file validation failed","text":"Input file validation failed","escaped":false}],"header":false,"align":null}],[{"text":"`in_progress`","tokens":[{"type":"codespan","raw":"`in_progress`","text":"in_progress"}],"header":false,"align":null},{"text":"Validation successful, task in progress","tokens":[{"type":"text","raw":"Validation successful, task in progress","text":"Validation successful, task in progress","escaped":false}],"header":false,"align":null}],[{"text":"`finalizing`","tokens":[{"type":"codespan","raw":"`finalizing`","text":"finalizing"}],"header":false,"align":null},{"text":"Task completed, summarizing results","tokens":[{"type":"text","raw":"Task completed, summarizing results","text":"Task completed, summarizing results","escaped":false}],"header":false,"align":null}],[{"text":"`completed`","tokens":[{"type":"codespan","raw":"`completed`","text":"completed"}],"header":false,"align":null},{"text":"Task completed, results summarized","tokens":[{"type":"text","raw":"Task completed, results summarized","text":"Task completed, results summarized","escaped":false}],"header":false,"align":null}],[{"text":"`expired`","tokens":[{"type":"codespan","raw":"`expired`","text":"expired"}],"header":false,"align":null},{"text":"Task timed out within 24 hours, not executed","tokens":[{"type":"text","raw":"Task timed out within 24 hours, not executed","text":"Task timed out within 24 hours, not executed","escaped":false}],"header":false,"align":null}],[{"text":"`cancelling`","tokens":[{"type":"codespan","raw":"`cancelling`","text":"cancelling"}],"header":false,"align":null},{"text":"Task cancellation in progress","tokens":[{"type":"text","raw":"Task cancellation in progress","text":"Task cancellation in progress","escaped":false}],"header":false,"align":null}],[{"text":"`cancelled`","tokens":[{"type":"codespan","raw":"`cancelled`","text":"cancelled"}],"header":false,"align":null},{"text":"Task has been cancelled","tokens":[{"type":"text","raw":"Task has been cancelled","text":"Task has been cancelled","escaped":false}],"header":false,"align":null}]]},{"type":"heading","raw":"### 5. Retrieve Results\n\n","depth":3,"text":"5. Retrieve Results","tokens":[{"type":"text","raw":"5. Retrieve Results","text":"5. Retrieve Results","escaped":false}]},{"type":"paragraph","raw":"When the task is completed, you can use the file API to specify the `output_file_id` in the Batch object to retrieve the result file, as shown in the example code below.","text":"When the task is completed, you can use the file API to specify the `output_file_id` in the Batch object to retrieve the result file, as shown in the example code below.","tokens":[{"type":"text","raw":"When the task is completed, you can use the file API to specify the ","text":"When the task is completed, you can use the file API to specify the ","escaped":false},{"type":"codespan","raw":"`output_file_id`","text":"output_file_id"},{"type":"text","raw":" in the Batch object to retrieve the result file, as shown in the example code below.","text":" in the Batch object to retrieve the result file, as shown in the example code below.","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```python\nfrom openai import OpenAI\nclient = OpenAI(\n    api_key=\"$your-dashscope-api-key\",\n    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\", \n)\n\nfile_response = client.files.content(batch.output_file_id)\nprint(file_response.text)\n```","lang":"python","text":"from openai import OpenAI\nclient = OpenAI(\n    api_key=\"$your-dashscope-api-key\",\n    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\", \n)\n\nfile_response = client.files.content(batch.output_file_id)\nprint(file_response.text)"},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```shell\ncurl https://dashscope.aliyuncs.com/compatible-mode/v1/files/file-xyz123/content  \\\n  -H \"Authorization: Bearer $DASHSCOPE_API_KEY\" > batch_output.jsonl\n```","lang":"shell","text":"curl https://dashscope.aliyuncs.com/compatible-mode/v1/files/file-xyz123/content  \\\n  -H \"Authorization: Bearer $DASHSCOPE_API_KEY\" > batch_output.jsonl"},{"type":"space","raw":"\n\n"},{"type":"paragraph","raw":"The output file format is also `jsonl`, with the number of lines consistent with the input file, but the order of requests may differ from the input file, determined by the order of execution. The output order is as follows:","text":"The output file format is also `jsonl`, with the number of lines consistent with the input file, but the order of requests may differ from the input file, determined by the order of execution. The output order is as follows:","tokens":[{"type":"text","raw":"The output file format is also ","text":"The output file format is also ","escaped":false},{"type":"codespan","raw":"`jsonl`","text":"jsonl"},{"type":"text","raw":", with the number of lines consistent with the input file, but the order of requests may differ from the input file, determined by the order of execution. The output order is as follows:","text":", with the number of lines consistent with the input file, but the order of requests may differ from the input file, determined by the order of execution. The output order is as follows:","escaped":false}]},{"type":"space","raw":"\n\n"},{"type":"code","raw":"```json\n{\n  \"id\": \"batch_req_123\",\n  \"custom_id\": \"request-2\",\n  \"response\": {\n    \"status_code\": 200,\n    \"request_id\": \"req_123\",\n    \"body\": {\n      \"id\": \"chatcmpl-123\",\n      \"object\": \"chat.completion\",\n      \"created\": 1711652795,\n      \"model\": \"gpt-3.5-turbo-0125\",\n      \"choices\": [\n        {\n          \"index\": 0,\n          \"message\": {\n            \"role\": \"assistant\",\n            \"content\": \"Hello.\"\n          },\n          \"logprobs\": null,\n          \"finish_reason\": \"stop\"\n        }\n      ],\n      \"usage\": {\n        \"prompt_tokens\": 22,\n        \"completion_tokens\": 2,\n        \"total_tokens\": 24\n      },\n      \"system_fingerprint\":\n","lang":"json","text":"{\n  \"id\": \"batch_req_123\",\n  \"custom_id\": \"request-2\",\n  \"response\": {\n    \"status_code\": 200,\n    \"request_id\": \"req_123\",\n    \"body\": {\n      \"id\": \"chatcmpl-123\",\n      \"object\": \"chat.completion\",\n      \"created\": 1711652795,\n      \"model\": \"gpt-3.5-turbo-0125\",\n      \"choices\": [\n        {\n          \"index\": 0,\n          \"message\": {\n            \"role\": \"assistant\",\n            \"content\": \"Hello.\"\n          },\n          \"logprobs\": null,\n          \"finish_reason\": \"stop\"\n        }\n      ],\n      \"usage\": {\n        \"prompt_tokens\": 22,\n        \"completion_tokens\": 2,\n        \"total_tokens\": 24\n      },\n      \"system_fingerprint\":"}]